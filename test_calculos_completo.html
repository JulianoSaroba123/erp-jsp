<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste C√°lculos KM e Tempo - ERP JSP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-dark text-white">
    <div class="container mt-5">
        <h1 class="text-center text-info mb-4">üß™ Teste de C√°lculos - KM e Tempo</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card bg-dark border-info">
                    <div class="card-header bg-info text-dark">
                        <h5 class="mb-0"><i class="fas fa-route me-2"></i>Controle de KM</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="km_inicial" class="form-label">KM Inicial</label>
                            <input type="number" class="form-control" id="km_inicial" value="15420">
                        </div>
                        <div class="mb-3">
                            <label for="km_final" class="form-label">KM Final</label>
                            <input type="number" class="form-control" id="km_final" value="15450">
                        </div>
                        <div class="alert alert-primary text-center">
                            <strong>KM Percorridos:</strong> <span id="km_total_calc">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card bg-dark border-warning">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Controle de Tempo</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="hora_inicial" class="form-label">Hora Inicial</label>
                            <input type="time" class="form-control" id="hora_inicial" value="18:00">
                        </div>
                        <div class="mb-3">
                            <label for="hora_final" class="form-label">Hora Final</label>
                            <input type="time" class="form-control" id="hora_final" value="19:15">
                        </div>
                        <div class="alert alert-warning text-dark text-center">
                            <strong>Tempo Total:</strong> <span id="tempo_total_calc">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card bg-dark border-success">
                    <div class="card-header bg-success">
                        <h5 class="mb-0"><i class="fas fa-terminal me-2"></i>Log de Debug</h5>
                    </div>
                    <div class="card-body">
                        <div id="debug_log" class="bg-black p-3 rounded" style="font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
                            <!-- Logs aparecer√£o aqui -->
                        </div>
                        <button type="button" class="btn btn-outline-danger btn-sm mt-2" onclick="limparLog()">
                            <i class="fas fa-trash me-1"></i>Limpar Log
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    function log(message) {
        const timestamp = new Date().toLocaleTimeString();
        const logDiv = $('#debug_log');
        logDiv.append(`<div class="text-info">[${timestamp}] ${message}</div>`);
        logDiv.scrollTop(logDiv[0].scrollHeight);
    }
    
    function limparLog() {
        $('#debug_log').empty();
        log('Log limpo pelo usu√°rio');
    }

    $(document).ready(function() {
        log('üöÄ Iniciando teste de c√°lculos...');
        
        // C√°lculo autom√°tico de KM
        function calcularKM() {
            const inicial = parseInt($('#km_inicial').val()) || 0;
            const final = parseInt($('#km_final').val()) || 0;
            
            log(`Calculando KM - Inicial: ${inicial}, Final: ${final}`);
            
            if ($('#km_total_calc').length > 0) {
                if (inicial > 0 && final > inicial) {
                    const total = final - inicial;
                    $('#km_total_calc').text(total + ' km');
                    log(`‚úÖ KM calculado: ${total} km`);
                } else {
                    $('#km_total_calc').text('-');
                    log('‚ùå KM n√£o calculado - valores inv√°lidos ou vazios');
                }
            } else {
                log('üî¥ ERRO: Elemento #km_total_calc n√£o encontrado!');
            }
        }

        // C√°lculo autom√°tico de tempo
        function calcularTempo() {
            const inicial = $('#hora_inicial').val();
            const final = $('#hora_final').val();
            
            log(`Calculando Tempo - Inicial: ${inicial}, Final: ${final}`);
            
            if ($('#tempo_total_calc').length > 0) {
                if (inicial && final) {
                    const [hi, mi] = inicial.split(':').map(Number);
                    const [hf, mf] = final.split(':').map(Number);
                    
                    const inicialMinutos = hi * 60 + mi;
                    const finalMinutos = hf * 60 + mf;
                    
                    if (finalMinutos > inicialMinutos) {
                        const totalMinutos = finalMinutos - inicialMinutos;
                        const horas = Math.floor(totalMinutos / 60);
                        const minutos = totalMinutos % 60;
                        
                        const tempoTexto = horas + 'h ' + minutos.toString().padStart(2, '0') + 'min';
                        $('#tempo_total_calc').text(tempoTexto);
                        log(`‚úÖ Tempo calculado: ${tempoTexto}`);
                    } else {
                        $('#tempo_total_calc').text('-');
                        log('‚ùå Tempo n√£o calculado - hora final menor que inicial');
                    }
                } else {
                    $('#tempo_total_calc').text('-');
                    log('‚ùå Tempo n√£o calculado - valores vazios');
                }
            } else {
                log('üî¥ ERRO: Elemento #tempo_total_calc n√£o encontrado!');
            }
        }

        // Event listeners
        $('#km_inicial, #km_final').on('input keyup blur change', function() {
            log('üì° Event listener KM triggered');
            calcularKM();
        });
        
        $('#hora_inicial, #hora_final').on('input keyup blur change', function() {
            log('üì° Event listener Tempo triggered');
            calcularTempo();
        });

        // Verifica√ß√£o de elementos
        log('üîç Verificando elementos:');
        log(`- #km_inicial: ${$('#km_inicial').length > 0 ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);
        log(`- #km_final: ${$('#km_final').length > 0 ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);
        log(`- #hora_inicial: ${$('#hora_inicial').length > 0 ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);
        log(`- #hora_final: ${$('#hora_final').length > 0 ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);
        log(`- #km_total_calc: ${$('#km_total_calc').length > 0 ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);
        log(`- #tempo_total_calc: ${$('#tempo_total_calc').length > 0 ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);

        // Inicializa√ß√£o
        setTimeout(function() {
            log('‚ö° Executando c√°lculos iniciais...');
            calcularKM();
            calcularTempo();
            log('üèÅ Inicializa√ß√£o completa!');
        }, 500);
    });
    </script>
</body>
</html>