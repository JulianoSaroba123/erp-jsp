{% extends "base.html" %}

{% block title %}Dashboard - {{ super() }}{% endblock %}

{% block breadcrumb %}
<span class="current-page">Dashboard</span>
{% endblock %}

{% block content %}
<style>
    .welcome-card {
        background: linear-gradient(135deg, rgba(0, 123, 255, 0.05) 0%, rgba(0, 201, 255, 0.03) 100%);
        border: 1.5px solid rgba(0, 123, 255, 0.2);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 123, 255, 0.1);
        transition: all 0.3s ease;
    }
    
    .welcome-card:hover {
        box-shadow: 0 12px 48px rgba(0, 123, 255, 0.15);
        transform: translateY(-2px);
    }
    
    .logo-dashboard {
        width: 80px;
        height: 80px;
        border-radius: 16px;
        box-shadow: 
            0 8px 24px rgba(0, 123, 255, 0.3),
            0 0 40px rgba(0, 212, 255, 0.2);
        border: 2px solid rgba(0, 212, 255, 0.4);
        padding: 4px;
        background: white;
        transition: all 0.3s ease;
        animation: logo-pulse-dashboard 3s ease-in-out infinite;
    }
    
    .logo-dashboard:hover {
        transform: scale(1.05);
        box-shadow: 
            0 12px 32px rgba(0, 123, 255, 0.4),
            0 0 50px rgba(0, 212, 255, 0.3);
    }
    
    @keyframes logo-pulse-dashboard {
        0%, 100% { 
            box-shadow: 
                0 8px 24px rgba(0, 123, 255, 0.3),
                0 0 40px rgba(0, 212, 255, 0.2);
        }
        50% { 
            box-shadow: 
                0 10px 28px rgba(0, 123, 255, 0.4),
                0 0 50px rgba(0, 212, 255, 0.3);
        }
    }
    
    .welcome-title {
        background: linear-gradient(135deg, #007bff, #00c9ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
    }
    
    .stat-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(0, 123, 255, 0.1);
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        border-color: rgba(0, 123, 255, 0.3);
    }

    .stat-icon {
        width: 64px;
        height: 64px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        background: rgba(6,182,212,0.06);
        box-shadow: 0 6px 18px rgba(6,182,212,0.04);
    }

    .quick-actions .btn {
        border-radius: 12px;
        padding: 0.9rem 1.1rem;
        min-width: 160px;
        background: linear-gradient(90deg, rgba(6,182,212,0.06), rgba(0,212,255,0.03));
        border: 1px solid rgba(6,182,212,0.06);
        color: #bfefff;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    .quick-actions .btn:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(6,182,212,0.06);
    }

    .card .card-body small.text-muted { color: #9aa6b2 }
</style>

<!-- Bem-vindo -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card welcome-card">
            <div class="card-body">
                <div class="row align-items-center">
                    {% if config and config.logo_base64 %}
                    <div class="col-auto">
                        <img src="{{ config.logo_base64 }}" 
                             alt="{{ config.nome_fantasia or 'Logo' }}"
                             class="logo-dashboard">
                    </div>
                    {% endif %}
                    <div class="col">
                        <h2 class="welcome-title mb-2">
                            <i class="fas fa-rocket me-3"></i>
                            Bem-vindo ao {{ config.nome_fantasia if config and config.nome_fantasia else COMPANY_NAME }}
                        </h2>
                        <p class="text-muted mb-0">
                            <strong>ERP v{{ SYSTEM_VERSION }}</strong> - Sistema de Gestão Empresarial
                        </p>
                        <small class="text-muted">
                            <i class="fas fa-chart-line me-1"></i>
                            Painel de controle e estatísticas gerais do sistema
                        </small>
                    </div>
                    <div class="col-auto text-end">
                        <div class="text-muted mb-1">
                            <i class="fas fa-calendar-alt me-2 text-primary"></i>
                            <span id="data-atual"></span>
                        </div>
                        <div class="text-muted">
                            <i class="fas fa-clock me-2 text-primary"></i>
                            <span id="hora-atual"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cards de Estatísticas -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="text-primary mb-0">{{ stats.total_clientes }}</h3>
                        <small class="text-muted">Clientes</small>
                    </div>
                    <div class="text-primary">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <a href="{{ url_for('cliente.listar') }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-eye me-1"></i>
                        Ver todos
                    </a>
                </div>
            </div>
        </div>
    </div>
                <!-- Ações Rápidas -->
                <div class="row mb-4 quick-actions">
                    <div class="col-12">
                        <div class="d-flex flex-wrap gap-3 align-items-center">
                            <a href="{{ url_for('ordem_servico.nova') }}" class="btn">
                                <i class="fas fa-wrench me-2"></i> Nova Ordem de Serviço
                            </a>
                            <a href="{{ url_for('cliente.novo') }}" class="btn">
                                <i class="fas fa-user-plus me-2"></i> Novo Cliente
                            </a>
                            <a href="{{ url_for('proposta.nova') }}" class="btn">
                                <i class="fas fa-file-signature me-2"></i> Nova Proposta
                            </a>
                            <a href="{{ url_for('produto.novo') }}" class="btn">
                                <i class="fas fa-box-open me-2"></i> Novo Produto
                            </a>
                        </div>
                    </div>
                </div>

    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="text-success mb-0">{{ stats.total_fornecedores }}</h3>
                        <small class="text-muted">Fornecedores</small>
                    </div>
                    <div class="text-success">
                        <i class="fas fa-truck fa-2x"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <a href="{{ url_for('fornecedor.listar') }}" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-eye me-1"></i>
                        Ver todos
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="text-info mb-0">{{ stats.total_produtos }}</h3>
                        <small class="text-muted">Produtos</small>
                    </div>
                    <div class="text-info">
                        <i class="fas fa-box fa-2x"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <a href="{{ url_for('produto.listar') }}" class="btn btn-outline-info btn-sm">
                        <i class="fas fa-eye me-1"></i>
                        Ver todos
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="text-warning mb-0">{{ stats.produtos_estoque_baixo }}</h3>
                        <small class="text-muted">Estoque Baixo</small>
                    </div>
                    <div class="text-warning">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                    </div>
                </div>
                <div class="mt-3">
                    {% if stats.produtos_estoque_baixo > 0 %}
                    <a href="{{ url_for('produto.estoque_baixo') }}" class="btn btn-outline-warning btn-sm">
                        <i class="fas fa-eye me-1"></i>
                        Ver itens
                    </a>
                    {% else %}
                    <span class="text-muted small">Tudo OK!</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Valor do Estoque -->
{% if stats.valor_estoque > 0 %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center">
                <h4 class="text-success mb-2">
                    <i class="fas fa-coins me-2"></i>
                    Valor Total do Estoque
                </h4>
                <h2 class="text-success">
                    R$ {{ "{:,.2f}".format(stats.valor_estoque).replace(',', 'X').replace('.', ',').replace('X', '.') }}
                </h2>
                <small class="text-muted">Baseado no preço de custo dos produtos em estoque</small>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Seções Informativas -->
<div class="row">
    <!-- Clientes Recentes -->
    {% if clientes_recentes %}
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-users me-2"></i>
                    Clientes Recentes
                </h6>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    {% for cliente in clientes_recentes %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold">{{ cliente.nome_display }}</div>
                            <small class="text-muted">
                                {% if cliente.email %}{{ cliente.email }}{% else %}{{ cliente.documento_formatado }}{% endif %}
                            </small>
                        </div>
                        <div>
                            <a href="{{ url_for('cliente.visualizar', id=cliente.id) }}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-eye"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('cliente.listar') }}" class="btn btn-outline-primary">
                        Ver todos os clientes
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Produtos com Estoque Baixo -->
    {% if produtos_estoque_baixo %}
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                    Produtos com Estoque Baixo
                </h6>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    {% for produto in produtos_estoque_baixo %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold">{{ produto.nome_display }}</div>
                            <small class="text-muted">
                                Estoque: {{ produto.estoque_atual }} {{ produto.unidade_medida }}
                                (Mín: {{ produto.estoque_minimo }})
                            </small>
                        </div>
                        <div>
                            <span class="badge bg-danger">Baixo</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('produto.estoque_baixo') }}" class="btn btn-outline-warning">
                        Ver todos os produtos
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Ações Rápidas -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-bolt me-2"></i>
                    Ações Rápidas
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('cliente.novo') }}" class="btn btn-outline-primary w-100">
                            <i class="fas fa-user-plus fa-2x d-block mb-2"></i>
                            Novo Cliente
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('fornecedor.novo') }}" class="btn btn-outline-success w-100">
                            <i class="fas fa-truck fa-2x d-block mb-2"></i>
                            Novo Fornecedor
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('produto.novo') }}" class="btn btn-outline-info w-100">
                            <i class="fas fa-box fa-2x d-block mb-2"></i>
                            Novo Produto
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('ordem_servico.novo') }}" class="btn btn-outline-warning w-100">
                            <i class="fas fa-file-invoice fa-2x d-block mb-2"></i>
                            Nova OS
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mensagem de Erro do Banco -->
{% if erro_banco %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning">
            <h5><i class="fas fa-exclamation-triangle me-2"></i>Banco de dados não inicializado</h5>
            <p>As tabelas do banco de dados ainda não foram criadas. Execute o script de criação:</p>
            <code>python scripts/criar_tabelas.py</code>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    // Atualiza data e hora
    function atualizarDataHora() {
        const agora = new Date();
        
        const data = agora.toLocaleDateString('pt-BR', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        const hora = agora.toLocaleTimeString('pt-BR');
        
        document.getElementById('data-atual').textContent = data;
        document.getElementById('hora-atual').textContent = hora;
    }
    
    // Atualiza a cada segundo
    atualizarDataHora();
    setInterval(atualizarDataHora, 1000);
</script>
{% endblock %}