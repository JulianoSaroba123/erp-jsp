{% extends "base.html" %}

{% block title %}Calculadora de Precificação - ERP JSP{% endblock %}

{% block content %}
<style>
    /* Tema Futurista Escuro para Precificação */
    body {
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
        color: #ffffff;
        min-height: 100vh;
    }
    
    .precificacao-container {
        background: rgba(0, 0, 0, 0.8);
        border: 1px solid #00ffff;
        border-radius: 15px;
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        backdrop-filter: blur(10px);
        padding: 30px;
        margin: 20px 0;
    }
    
    .cyber-card {
        background: linear-gradient(145deg, rgba(0, 20, 40, 0.9), rgba(0, 10, 30, 0.9));
        border: 1px solid #00ffff;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.2);
        transition: all 0.3s ease;
    }
    
    .cyber-card:hover {
        box-shadow: 0 8px 25px rgba(0, 255, 255, 0.4);
        border-color: #00ccff;
    }
    
    .cyber-title {
        color: #00ffff;
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 20px;
        text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        display: flex;
        align-items: center;
    }
    
    .cyber-title i {
        margin-right: 15px;
        font-size: 1.8rem;
    }
    
    .form-control {
        background: rgba(0, 40, 80, 0.3);
        border: 2px solid rgba(0, 255, 255, 0.3);
        border-radius: 8px;
        color: #ffffff;
        padding: 12px 15px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        background: rgba(0, 40, 80, 0.5);
        border-color: #00ffff;
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        color: #ffffff;
    }
    
    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }
    
    .form-label {
        color: #b3e5fc;
        font-weight: 500;
        margin-bottom: 8px;
    }
    
    .btn-cyber {
        background: linear-gradient(45deg, #00ffff, #0099cc);
        border: none;
        border-radius: 8px;
        color: #000;
        font-weight: bold;
        padding: 15px 30px;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }
    
    .btn-cyber:hover {
        background: linear-gradient(45deg, #00ccff, #0077aa);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 255, 255, 0.5);
        color: #000;
    }
    
    .cyber-divider {
        height: 2px;
        background: linear-gradient(90deg, transparent, #00ffff, transparent);
        margin: 30px 0;
    }
    
    .input-group-text {
        background: rgba(0, 40, 80, 0.5);
        border: 2px solid rgba(0, 255, 255, 0.3);
        color: #00ffff;
        font-weight: bold;
    }
    
    .alert-cyber {
        background: rgba(0, 255, 255, 0.1);
        border: 1px solid rgba(0, 255, 255, 0.3);
        border-radius: 8px;
        color: #b3e5fc;
    }
    
    .cyber-subtitle {
        color: #b3e5fc;
        font-size: 0.9rem;
        margin-bottom: 15px;
        font-style: italic;
    }
    
    .col-form-group {
        margin-bottom: 20px;
    }
</style>

<div class="container-fluid">
    <!-- Cabeçalho Principal -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="precificacao-container text-center">
                <h1 class="cyber-title justify-content-center">
                    <i class="fas fa-calculator"></i>
                    Calculadora de Precificação Avançada
                </h1>
                <p class="cyber-subtitle">
                    Sistema inteligente para cálculo de valor/hora, valor/dia e valor por empreita
                </p>
            </div>
        </div>
    </div>

    <!-- Formulário de Precificação -->
    <form method="POST" action="{{ url_for('precificacao.calculadora') }}" class="needs-validation" novalidate>
        <div class="row">
            
            <!-- CUSTOS FIXOS -->
            <div class="col-lg-6">
                <div class="cyber-card">
                    <h3 class="cyber-title">
                        <i class="fas fa-building"></i>
                        Custos Fixos Mensais
                    </h3>
                    <p class="cyber-subtitle">Gastos que não variam com a produção</p>
                    
                    <div class="row">
                        <div class="col-md-6 col-form-group">
                            <label for="custo_aluguel" class="form-label">
                                <i class="fas fa-home me-2"></i>Aluguel
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_aluguel" name="custo_aluguel" 
                                       step="0.01" placeholder="0,00" 
                                       value="{{ config.custo_aluguel if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_energia" class="form-label">
                                <i class="fas fa-bolt me-2"></i>Energia Elétrica
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_energia" name="custo_energia" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_energia if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_internet" class="form-label">
                                <i class="fas fa-wifi me-2"></i>Internet/Telecomunicações
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_internet" name="custo_internet" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_internet if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_contabilidade" class="form-label">
                                <i class="fas fa-calculator me-2"></i>Contabilidade
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_contabilidade" name="custo_contabilidade" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_contabilidade if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_impostos" class="form-label">
                                <i class="fas fa-file-invoice me-2"></i>Impostos
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_impostos" name="custo_impostos" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_impostos if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_seguros" class="form-label">
                                <i class="fas fa-shield-alt me-2"></i>Seguros
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_seguros" name="custo_seguros" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_seguros if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_financiamento" class="form-label">
                                <i class="fas fa-credit-card me-2"></i>Financiamentos
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_financiamento" name="custo_financiamento" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_financiamento if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_outros_fixos" class="form-label">
                                <i class="fas fa-ellipsis-h me-2"></i>Outros Fixos
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_outros_fixos" name="custo_outros_fixos" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_outros_fixos if config else 0 }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CUSTOS VARIÁVEIS -->
            <div class="col-lg-6">
                <div class="cyber-card">
                    <h3 class="cyber-title">
                        <i class="fas fa-chart-line"></i>
                        Custos Variáveis Mensais
                    </h3>
                    <p class="cyber-subtitle">Gastos que variam conforme a produção</p>
                    
                    <div class="row">
                        <div class="col-md-6 col-form-group">
                            <label for="custo_combustivel" class="form-label">
                                <i class="fas fa-gas-pump me-2"></i>Combustível
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_combustivel" name="custo_combustivel" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_combustivel if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_ferramentas" class="form-label">
                                <i class="fas fa-tools me-2"></i>Ferramentas
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_ferramentas" name="custo_ferramentas" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_ferramentas if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_materiais" class="form-label">
                                <i class="fas fa-boxes me-2"></i>Materiais
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_materiais" name="custo_materiais" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_materiais if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_comissoes" class="form-label">
                                <i class="fas fa-percentage me-2"></i>Comissões
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_comissoes" name="custo_comissoes" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_comissoes if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_marketing" class="form-label">
                                <i class="fas fa-bullhorn me-2"></i>Marketing
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_marketing" name="custo_marketing" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_marketing if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_manutencao" class="form-label">
                                <i class="fas fa-wrench me-2"></i>Manutenção
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_manutencao" name="custo_manutencao" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_manutencao if config else 0 }}">
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-form-group">
                            <label for="custo_outros_variaveis" class="form-label">
                                <i class="fas fa-ellipsis-h me-2"></i>Outros Variáveis
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" class="form-control" id="custo_outros_variaveis" name="custo_outros_variaveis" 
                                       step="0.01" placeholder="0,00"
                                       value="{{ config.custo_outros_variaveis if config else 0 }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="cyber-divider"></div>
        
        <div class="row">
            <!-- MÃO DE OBRA -->
            <div class="col-lg-8">
                <div class="cyber-card">
                    <h3 class="cyber-title">
                        <i class="fas fa-users"></i>
                        Mão de Obra
                    </h3>
                    <p class="cyber-subtitle">Custos com colaboradores fixos e diaristas</p>
                    
                    <div class="row">
                        <!-- Colaboradores Fixos -->
                        <div class="col-md-6">
                            <h5 class="text-info mb-3">
                                <i class="fas fa-user-tie me-2"></i>Colaboradores Fixos
                            </h5>
                            
                            <div class="col-form-group">
                                <label for="colaboradores_fixos_qtd" class="form-label">Quantidade</label>
                                <input type="number" class="form-control" id="colaboradores_fixos_qtd" 
                                       name="colaboradores_fixos_qtd" min="0" placeholder="0"
                                       value="{{ config.colaboradores_fixos_qtd if config else 0 }}">
                            </div>
                            
                            <div class="col-form-group">
                                <label for="salario_medio_fixo" class="form-label">Salário Médio</label>
                                <div class="input-group">
                                    <span class="input-group-text">R$</span>
                                    <input type="number" class="form-control" id="salario_medio_fixo" 
                                           name="salario_medio_fixo" step="0.01" placeholder="0,00"
                                           value="{{ config.salario_medio_fixo if config else 0 }}">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Colaboradores Diaristas -->
                        <div class="col-md-6">
                            <h5 class="text-info mb-3">
                                <i class="fas fa-user-clock me-2"></i>Colaboradores Diaristas
                            </h5>
                            
                            <div class="col-form-group">
                                <label for="colaboradores_diaristas_qtd" class="form-label">Quantidade</label>
                                <input type="number" class="form-control" id="colaboradores_diaristas_qtd" 
                                       name="colaboradores_diaristas_qtd" min="0" placeholder="0"
                                       value="{{ config.colaboradores_diaristas_qtd if config else 0 }}">
                            </div>
                            
                            <div class="col-form-group">
                                <label for="valor_diaria" class="form-label">Valor da Diária</label>
                                <div class="input-group">
                                    <span class="input-group-text">R$</span>
                                    <input type="number" class="form-control" id="valor_diaria" 
                                           name="valor_diaria" step="0.01" placeholder="0,00"
                                           value="{{ config.valor_diaria if config else 0 }}">
                                </div>
                            </div>
                            
                            <div class="col-form-group">
                                <label for="dias_trabalhados_mes" class="form-label">Dias/Mês</label>
                                <input type="number" class="form-control" id="dias_trabalhados_mes" 
                                       name="dias_trabalhados_mes" min="0" max="31" placeholder="0"
                                       value="{{ config.dias_trabalhados_mes if config else 0 }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PARÂMETROS -->
            <div class="col-lg-4">
                <div class="cyber-card">
                    <h3 class="cyber-title">
                        <i class="fas fa-cogs"></i>
                        Parâmetros
                    </h3>
                    <p class="cyber-subtitle">Configurações de produtividade e margem</p>
                    
                    <div class="col-form-group">
                        <label for="nome_simulacao" class="form-label">
                            <i class="fas fa-tag me-2"></i>Nome da Simulação
                        </label>
                        <input type="text" class="form-control" id="nome_simulacao" name="nome_simulacao" 
                               placeholder="Ex: Simulação Janeiro 2025"
                               value="{{ config.nome_simulacao if config else '' }}">
                    </div>
                    
                    <div class="col-form-group">
                        <label for="horas_mensais_colaborador" class="form-label">
                            <i class="fas fa-clock me-2"></i>Horas/Mês por Colaborador
                        </label>
                        <input type="number" class="form-control" id="horas_mensais_colaborador" 
                               name="horas_mensais_colaborador" step="0.1" placeholder="160"
                               value="{{ config.horas_mensais_colaborador if config else 160 }}">
                        <small class="text-muted">8h x 20 dias = 160h</small>
                    </div>
                    
                    <div class="col-form-group">
                        <label for="colaboradores_produtivos" class="form-label">
                            <i class="fas fa-user-check me-2"></i>Colaboradores Produtivos
                        </label>
                        <input type="number" class="form-control" id="colaboradores_produtivos" 
                               name="colaboradores_produtivos" min="1" placeholder="1"
                               value="{{ config.colaboradores_produtivos if config else 1 }}">
                        <small class="text-muted">Quantos trabalham diretamente</small>
                    </div>
                    
                    <div class="col-form-group">
                        <label for="margem_lucro_percentual" class="form-label">
                            <i class="fas fa-chart-pie me-2"></i>Margem de Lucro (%)
                        </label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="margem_lucro_percentual" 
                                   name="margem_lucro_percentual" step="0.1" min="0" placeholder="30"
                                   value="{{ config.margem_lucro_percentual if config else 30 }}">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                    
                    <div class="col-form-group">
                        <label for="observacoes" class="form-label">
                            <i class="fas fa-sticky-note me-2"></i>Observações
                        </label>
                        <textarea class="form-control" id="observacoes" name="observacoes" rows="3" 
                                  placeholder="Anotações sobre esta simulação...">{{ config.observacoes if config else '' }}</textarea>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="cyber-divider"></div>
        
        <!-- Botões de Ação -->
        <div class="row">
            <div class="col-12 text-center">
                <div class="cyber-card">
                    <button type="submit" class="btn btn-cyber btn-lg me-3">
                        <i class="fas fa-calculator me-2"></i>
                        Calcular Precificação
                    </button>
                    
                    <a href="{{ url_for('precificacao.historico') }}" class="btn btn-outline-info btn-lg">
                        <i class="fas fa-history me-2"></i>
                        Ver Histórico
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
// Validação de formulário e efeitos visuais
document.addEventListener('DOMContentLoaded', function() {
    // Validação de campos obrigatórios
    const form = document.querySelector('.needs-validation');
    
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });
    
    // Efeito de foco nos inputs
    const inputs = document.querySelectorAll('.form-control');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.style.boxShadow = '0 0 15px rgba(0, 255, 255, 0.3)';
        });
        
        input.addEventListener('blur', function() {
            this.style.boxShadow = '';
        });
    });
    
    // Formatação automática de valores monetários
    const moneyInputs = document.querySelectorAll('input[step="0.01"]');
    moneyInputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.value && !isNaN(this.value)) {
                this.value = parseFloat(this.value).toFixed(2);
            }
        });
    });
});
</script>

{% endblock %}