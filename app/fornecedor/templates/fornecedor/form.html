{% extends "base.html" %}

{% block title %}
    {% if fornecedor.id %}Editar Fornecedor{% else %} Novo Fornecedor{% endif %} - {{ super() }}
{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('painel.dashboard') }}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('fornecedor.listar') }}">Fornecedores</a></li>
        <li class="breadcrumb-item active">
            {% if fornecedor.id %}Editar{% else %}Novo{% endif %}
        </li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-truck{% if not fornecedor.id %} fa-plus{% else %} fa-edit{% endif %} me-2"></i>
                        {% if fornecedor.id %}
                            Editar Fornecedor: {{ fornecedor.nome_completo }}
                        {% else %}
                            ‚ûï Novo Fornecedor
                        {% endif %}
                    </h4>
                </div>
                
                <div class="card-body">
                    <form method="POST" novalidate>
                        <!-- Dados Principais -->
                        <div class="form-section">
                            <h6 class="section-title">
                                <i class="fas fa-id-card me-2"></i>
                                Dados Principais
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-3">
                                    <label for="tipo" class="form-label">Tipo *</label>
                                    <select class="form-select" id="tipo" name="tipo" required>
                                        <option value="">Selecione...</option>
                                        <option value="PF" {% if fornecedor.tipo == 'PF' %}selected{% endif %}>
                                            üë§ Pessoa F√≠sica
                                        </option>
                                        <option value="PJ" {% if fornecedor.tipo == 'PJ' %}selected{% endif %}>
                                            üè¢ Pessoa Jur√≠dica
                                        </option>
                                    </select>
                                </div>
                                
                                <div class="col-md-9" id="campo-nome-simples">
                                    <label for="nome" class="form-label">
                                        <span id="label-nome">Nome Completo</span> *
                                    </label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="nome" 
                                           name="nome" 
                                           value="{{ fornecedor.nome or '' }}" 
                                           required 
                                           maxlength="150"
                                           placeholder="Nome do fornecedor">
                                </div>
                                
                                <!-- Para Pessoa Jur√≠dica -->
                                <div id="campos-pj" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-12 mb-3">
                                            <label for="razao_social_pj" class="form-label">Raz√£o Social *</label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   id="razao_social_pj" 
                                                   name="nome" 
                                                   value="{{ fornecedor.nome or '' }}"
                                                   maxlength="150"
                                                   placeholder="Raz√£o social da empresa">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="nome_fantasia" class="form-label">Nome Fantasia *</label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   id="nome_fantasia" 
                                                   name="nome_fantasia" 
                                                   value="{{ fornecedor.nome_fantasia or '' }}"
                                                   maxlength="150"
                                                   placeholder="Nome fantasia da empresa">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="inscricao_estadual" class="form-label">Inscri√ß√£o Estadual</label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   id="inscricao_estadual" 
                                                   name="inscricao_estadual" 
                                                   value="{{ fornecedor.inscricao_estadual or '' }}"
                                                   maxlength="20"
                                                   placeholder="Inscri√ß√£o Estadual">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Campos adicionais PF -->
                        <div id="extras-pf" class="row mt-3" style="display: none;">
                            <div class="col-md-3">
                                <label for="data_nascimento" class="form-label">Data Nascimento</label>
                                <input type="date" 
                                       class="form-control" 
                                       id="data_nascimento" 
                                       name="data_nascimento" 
                                       value="{{ fornecedor.data_nascimento or '' }}">
                            </div>
                            <div class="col-md-3">
                                <label for="genero" class="form-label">G√™nero</label>
                                <select class="form-select" id="genero" name="genero">
                                    <option value="">Selecione...</option>
                                    <option value="Masculino" {% if fornecedor.genero == 'Masculino' %}selected{% endif %}>Masculino</option>
                                    <option value="Feminino" {% if fornecedor.genero == 'Feminino' %}selected{% endif %}>Feminino</option>
                                    <option value="Outros" {% if fornecedor.genero == 'Outros' %}selected{% endif %}>Outros</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="estado_civil" class="form-label">Estado Civil</label>
                                <select class="form-select" id="estado_civil" name="estado_civil">
                                    <option value="">Selecione...</option>
                                    <option value="Solteiro(a)" {% if fornecedor.estado_civil == 'Solteiro(a)' %}selected{% endif %}>Solteiro(a)</option>
                                    <option value="Casado(a)" {% if fornecedor.estado_civil == 'Casado(a)' %}selected{% endif %}>Casado(a)</option>
                                    <option value="Divorciado(a)" {% if fornecedor.estado_civil == 'Divorciado(a)' %}selected{% endif %}>Divorciado(a)</option>
                                    <option value="Vi√∫vo(a)" {% if fornecedor.estado_civil == 'Vi√∫vo(a)' %}selected{% endif %}>Vi√∫vo(a)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="profissao" class="form-label">Profiss√£o</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="profissao" 
                                       name="profissao" 
                                       value="{{ fornecedor.profissao or '' }}"
                                       maxlength="100"
                                       placeholder="Ex: Contador, Engenheiro">
                            </div>
                        </div>
                        
                        <!-- Campos adicionais PJ -->
                        <div id="extras-pj" class="row mt-3" style="display: none;">
                            <div class="col-md-3">
                                <label for="data_fundacao" class="form-label">Data Funda√ß√£o</label>
                                <input type="date" 
                                       class="form-control" 
                                       id="data_fundacao" 
                                       name="data_fundacao" 
                                       value="{{ fornecedor.data_fundacao or '' }}">
                            </div>
                            <div class="col-md-3">
                                <label for="porte_empresa" class="form-label">Porte</label>
                                <select class="form-select" id="porte_empresa" name="porte_empresa">
                                    <option value="">Selecione...</option>
                                    <option value="MEI" {% if fornecedor.porte_empresa == 'MEI' %}selected{% endif %}>MEI</option>
                                    <option value="Micro" {% if fornecedor.porte_empresa == 'Micro' %}selected{% endif %}>Microempresa</option>
                                    <option value="Pequena" {% if fornecedor.porte_empresa == 'Pequena' %}selected{% endif %}>Pequena</option>
                                    <option value="M√©dia" {% if fornecedor.porte_empresa == 'M√©dia' %}selected{% endif %}>M√©dia</option>
                                    <option value="Grande" {% if fornecedor.porte_empresa == 'Grande' %}selected{% endif %}>Grande</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="segmento" class="form-label">Segmento</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="segmento" 
                                       name="segmento" 
                                       value="{{ fornecedor.segmento or '' }}"
                                       placeholder="Ex: Tecnologia, Com√©rcio, Ind√∫stria"
                                       maxlength="100">
                            </div>
                        </div>
                        
                        <!-- Classifica√ß√£o e Status -->
                        <div class="form-section">
                            <h6 class="section-title">
                                <i class="fas fa-star me-2"></i>
                                Classifica√ß√£o e Status
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-3">
                                    <label for="classificacao" class="form-label">Classifica√ß√£o</label>
                                    <select class="form-select" id="classificacao" name="classificacao">
                                        <option value="">Selecione...</option>
                                        <option value="Classe A - Premium" {% if fornecedor.classificacao == 'Classe A - Premium' %}selected{% endif %}>üü¢ Classe A - Premium</option>
                                        <option value="Classe B - Bom" {% if fornecedor.classificacao == 'Classe B - Bom' %}selected{% endif %}>üü° Classe B - Bom</option>
                                        <option value="Classe C - Regular" {% if fornecedor.classificacao == 'Classe C - Regular' %}selected{% endif %}>üü† Classe C - Regular</option>
                                        <option value="Classe D - Aten√ß√£o" {% if fornecedor.classificacao == 'Classe D - Aten√ß√£o' %}selected{% endif %}>üî¥ Classe D - Aten√ß√£o</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="origem" class="form-label">Como nos conheceu</label>
                                    <select class="form-select" id="origem" name="origem">
                                        <option value="">Selecione...</option>
                                        <option value="Indica√ß√£o" {% if fornecedor.origem == 'Indica√ß√£o' %}selected{% endif %}>Indica√ß√£o</option>
                                        <option value="Site/Google" {% if fornecedor.origem == 'Site/Google' %}selected{% endif %}>Site/Google</option>
                                        <option value="Redes Sociais" {% if fornecedor.origem == 'Redes Sociais' %}selected{% endif %}>Redes Sociais</option>
                                        <option value="Feira/Evento" {% if fornecedor.origem == 'Feira/Evento' %}selected{% endif %}>Feira/Evento</option>
                                        <option value="Outros" {% if fornecedor.origem == 'Outros' %}selected{% endif %}>Outros</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="website" class="form-label">Website</label>
                                    <input type="url" 
                                           class="form-control" 
                                           id="website" 
                                           name="website" 
                                           value="{{ fornecedor.website or fornecedor.site or '' }}"
                                           placeholder="https://exemplo.com.br"
                                           maxlength="200">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Documentos -->
                        <div class="form-section">
                            <h6 class="section-title">
                                <i class="fas fa-file-alt me-2"></i>
                                Documentos
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="cpf_cnpj" class="form-label">
                                        <span id="label-documento">CPF/CNPJ</span> *
                                    </label>
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               id="cpf_cnpj"
                                               name="cpf_cnpj"
                                               value="{{ fornecedor.cnpj_cpf or '' }}"
                                               placeholder="000.000.000-00"
                                               required
                                               maxlength="20">
                                        <button type="button" 
                                                class="btn btn-outline-primary" 
                                                id="btn-consultar-cnpj"
                                                title="Consultar CNPJ automaticamente"
                                                style="display: none;">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <small class="text-muted">Para CNPJ, clique no bot√£o üîç para busca autom√°tica</small>
                                </div>
                                
                                <div class="col-md-4">
                                    <label for="rg_ie" class="form-label">
                                        <span id="label-rg-ie">RG/IE</span>
                                    </label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="rg_ie" 
                                           name="rg_ie" 
                                           value="{{ fornecedor.rg_ie or fornecedor.inscricao_estadual or '' }}"
                                           maxlength="20"
                                           placeholder="Inscri√ß√£o Estadual">
                                </div>
                                
                                <div class="col-md-4">
                                    <label for="im" class="form-label">Inscri√ß√£o Municipal</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="im" 
                                           name="im" 
                                           value="{{ fornecedor.im or fornecedor.inscricao_municipal or '' }}"
                                           maxlength="20"
                                           placeholder="Inscri√ß√£o Municipal">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contatos -->
                        <div class="form-section">
                            <h6 class="section-title">
                                <i class="fas fa-phone me-2"></i>
                                Contatos
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="email" class="form-label">Email Principal</label>
                                    <input type="email" 
                                           class="form-control" 
                                           id="email" 
                                           name="email" 
                                           value="{{ fornecedor.email or '' }}"
                                           maxlength="150"
                                           placeholder="contato@empresa.com.br">
                                </div>
                                
                                <div class="col-md-4">
                                    <label for="telefone" class="form-label">Telefone</label>
                                    <input type="tel" 
                                           class="form-control" 
                                           id="telefone" 
                                           name="telefone" 
                                           value="{{ fornecedor.telefone or '' }}"
                                           placeholder="(11) 1234-5678">
                                </div>
                                
                                <div class="col-md-4">
                                    <label for="celular" class="form-label">Celular</label>
                                    <input type="tel" 
                                           class="form-control" 
                                           id="celular" 
                                           name="celular" 
                                           value="{{ fornecedor.celular or '' }}"
                                           placeholder="(11) 99999-9999">
                                </div>
                                
                                <div class="col-md-4 mt-3">
                                    <label for="whatsapp" class="form-label">WhatsApp</label>
                                    <input type="tel" 
                                           class="form-control" 
                                           id="whatsapp" 
                                           name="whatsapp" 
                                           value="{{ fornecedor.whatsapp or '' }}"
                                           placeholder="(11) 99999-9999">
                                </div>
                                
                                <div class="col-md-8 mt-3">
                                    <label for="email_financeiro" class="form-label">Email Financeiro</label>
                                    <input type="email" 
                                           class="form-control" 
                                           id="email_financeiro" 
                                           name="email_financeiro" 
                                           value="{{ fornecedor.email_financeiro or '' }}"
                                           maxlength="150"
                                           placeholder="financeiro@empresa.com.br">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contato Respons√°vel -->
                        <div class="form-section">
                            <h6 class="section-title">
                                <i class="fas fa-user-tie me-2"></i>
                                Contato Respons√°vel
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="contato_nome" class="form-label">Nome do Respons√°vel</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="contato_nome" 
                                           name="contato_nome" 
                                           value="{{ fornecedor.contato_nome or '' }}"
                                           maxlength="100"
                                           placeholder="Nome do contato">
                                </div>
                                
                                <div class="col-md-4">
                                    <label for="contato_cargo" class="form-label">Cargo</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="contato_cargo" 
                                           name="contato_cargo" 
                                           value="{{ fornecedor.contato_cargo or '' }}"
                                           placeholder="Ex: Gerente, Diretor..."
                                           maxlength="100">
                                </div>
                                
                                <div class="col-md-4">
                                    <label for="contato_telefone" class="form-label">Telefone do Contato</label>
                                    <input type="tel" 
                                           class="form-control" 
                                           id="contato_telefone" 
                                           name="contato_telefone" 
                                           value="{{ fornecedor.contato_telefone or '' }}"
                                           placeholder="(11) 99999-9999">
                                </div>
                                
                                <div class="col-md-12 mt-3">
                                    <label for="contato_email" class="form-label">Email do Contato</label>
                                    <input type="email" 
                                           class="form-control" 
                                           id="contato_email" 
                                           name="contato_email" 
                                           value="{{ fornecedor.contato_email or '' }}"
                                           maxlength="150"
                                           placeholder="contato@empresa.com.br">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Endere√ßo -->
                        <div class="form-section">
                            <h6 class="section-title">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                Endere√ßo
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="cep" class="form-label">CEP</label> 
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               id="cep"
                                               name="cep"
                                               value="{{ fornecedor.cep or '' }}"
                                               placeholder="00000-000">
                                        <button type="button" 
                                                class="btn btn-outline-primary" 
                                                id="btn-consultar-cep"
                                                title="Consultar CEP automaticamente">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <small class="text-muted">Clique no bot√£o para busca autom√°tica</small>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="endereco" class="form-label">Endere√ßo</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="endereco" 
                                           name="endereco" 
                                           value="{{ fornecedor.endereco or '' }}"
                                           maxlength="200"
                                           placeholder="Rua, Avenida, etc.">
                                </div>
                                
                                <div class="col-md-3 mb-3">
                                    <label for="numero" class="form-label">N√∫mero</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="numero" 
                                           name="numero" 
                                           value="{{ fornecedor.numero or '' }}"
                                           maxlength="20"
                                           placeholder="123">
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="complemento" class="form-label">Complemento</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="complemento" 
                                           name="complemento" 
                                           value="{{ fornecedor.complemento or '' }}"
                                           maxlength="100"
                                           placeholder="Apt, Sala, etc.">
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="bairro" class="form-label">Bairro</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="bairro" 
                                           name="bairro" 
                                           value="{{ fornecedor.bairro or '' }}"
                                           maxlength="100"
                                           placeholder="Nome do bairro">
                                </div>
                                
                                <div class="col-md-3 mb-3">
                                    <label for="cidade" class="form-label">Cidade</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="cidade" 
                                           name="cidade" 
                                           value="{{ fornecedor.cidade or '' }}"
                                           maxlength="100"
                                           placeholder="Nome da cidade">
                                </div>
                                
                                <div class="col-md-1 mb-3">
                                    <label for="estado" class="form-label">UF</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="estado" 
                                           name="estado" 
                                           value="{{ fornecedor.estado or '' }}"
                                           maxlength="2"
                                           placeholder="SP">
                                </div>
                                
                                <div class="col-md-12">
                                    <label for="pais" class="form-label">Pa√≠s</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="pais" 
                                           name="pais" 
                                           value="{{ fornecedor.pais or 'Brasil' }}"
                                           maxlength="50"
                                           placeholder="Brasil">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Informa√ß√µes Comerciais -->
                        <div class="form-section">
                            <h6 class="section-title">
                                <i class="fas fa-handshake me-2"></i>
                                Informa√ß√µes Comerciais
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="categoria" class="form-label">Categoria</label>
                                    <select class="form-select" id="categoria" name="categoria">
                                        <option value="">Selecione...</option>
                                        <option value="Equipamentos" {% if fornecedor.categoria == 'Equipamentos' %}selected{% endif %}>Equipamentos</option>
                                        <option value="Servi√ßos" {% if fornecedor.categoria == 'Servi√ßos' %}selected{% endif %}>Servi√ßos</option>
                                        <option value="Mat√©ria-prima" {% if fornecedor.categoria == 'Mat√©ria-prima' %}selected{% endif %}>Mat√©ria-prima</option>
                                        <option value="Software" {% if fornecedor.categoria == 'Software' %}selected{% endif %}>Software</option>
                                        <option value="Consultoria" {% if fornecedor.categoria == 'Consultoria' %}selected{% endif %}>Consultoria</option>
                                        <option value="Outros" {% if fornecedor.categoria == 'Outros' %}selected{% endif %}>Outros</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="condicoes_pagamento" class="form-label">Condi√ß√µes Pagamento</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="condicoes_pagamento" 
                                           name="condicoes_pagamento" 
                                           value="{{ fornecedor.condicoes_pagamento or '' }}"
                                           maxlength="100"
                                           placeholder="Ex: 30/60 dias">
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="prazo_entrega" class="form-label">Prazo Entrega</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="prazo_entrega" 
                                           name="prazo_entrega" 
                                           value="{{ fornecedor.prazo_entrega or '' }}"
                                           maxlength="50"
                                           placeholder="Ex: 5-10 dias √∫teis">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Observa√ß√µes -->
                        <div class="form-section">
                            <h6 class="section-title">
                                <i class="fas fa-sticky-note me-2"></i>
                                Observa√ß√µes
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label for="observacoes" class="form-label">Observa√ß√µes Gerais</label>
                                    <textarea class="form-control" 
                                              id="observacoes" 
                                              name="observacoes" 
                                              rows="3" 
                                              maxlength="500"
                                              placeholder="Observa√ß√µes sobre o fornecedor...">{{ fornecedor.observacoes or '' }}</textarea>
                                    <small class="text-muted">M√°ximo 500 caracteres</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bot√µes -->
                        <div class="form-section">
                            <div class="d-flex justify-content-between">
                                <a href="{{ url_for('fornecedor.listar') }}" 
                                   class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    Voltar
                                </a>
                                
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-save me-2"></i>
                                    {% if fornecedor.id %}
                                        Atualizar Fornecedor
                                    {% else %}
                                        Salvar Fornecedor
                                    {% endif %}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border: 1px solid #e3e6f0;
        border-radius: 0.35rem;
        background-color: #f8f9fc;
    }
    
    .section-title {
        color: #5a5c69;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e3e6f0;
    }
    
    .form-control:focus,
    .form-select:focus {
        border-color: #4e73df;
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }
    
    .btn-primary {
        background-color: #4e73df;
        border-color: #4e73df;
    }
    
    .btn-primary:hover {
        background-color: #2e59d9;
        border-color: #2e59d9;
    }
    
    .card {
        border: 0;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
    }
    
    .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-bottom: 0;
    }
    
    .input-group-text {
        background-color: #f8f9fc;
        border-color: #d1d3e2;
    }
    
    .small, small {
        color: #6c757d;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded',function() {
        console.log('üöÄ INICIANDO SCRIPT DE FORNECEDOR');
        
        const tipoSelect = document.getElementById('tipo');
        const labelDocumento = document.getElementById('label-documento');
        const labelRgIe = document.getElementById('label-rg-ie');
        const cpfCnpjInput = document.getElementById('cpf_cnpj');
        const btnCnpj = document.getElementById('btn-consultar-cnpj');
        const camposPj = document.getElementById('campos-pj');
        const campoNomeSimples = document.getElementById('campo-nome-simples');
        const extrasPf = document.getElementById('extras-pf');
        const extrasPj = document.getElementById('extras-pj');
        const nomeFantasia = document.getElementById('nome_fantasia');
        const razaoSocialPj = document.getElementById('razao_social_pj');
        
        console.log('üìã Elementos encontrados:');
        console.log('  - tipoSelect:', tipoSelect ? '‚úÖ' : '‚ùå');
        console.log('  - btnCnpj:', btnCnpj ? '‚úÖ' : '‚ùå');
        console.log('  - cpfCnpjInput:', cpfCnpjInput ? '‚úÖ' : '‚ùå');
        console.log('  - razaoSocialPj:', razaoSocialPj ? '‚úÖ' : '‚ùå');
        console.log('  - nomeFantasia:', nomeFantasia ? '‚úÖ' : '‚ùå');
        
        // Atualiza interface conforme o tipo
        function atualizarInterface() {
            console.log('üîÑ atualizarInterface() chamada');
            const tipoPJ = tipoSelect.value === 'PJ';
            console.log('  - Tipo selecionado:', tipoSelect.value);
            console.log('  - √â PJ?:', tipoPJ);
            
            if (tipoPJ) {
                // Pessoa Jur√≠dica
                labelDocumento.textContent = 'CNPJ';
                labelRgIe.textContent = 'Inscri√ß√£o Estadual';
                cpfCnpjInput.placeholder = '00.000.000/0000-00';
                
                // Esconde campo nome simples
                if (campoNomeSimples) {
                    campoNomeSimples.style.display = 'none';
                    document.getElementById('nome').removeAttribute('required');
                }
                
                // Mostra campos PJ
                camposPj.style.display = 'block';
                extrasPj.style.display = 'flex';
                extrasPf.style.display = 'none';
                
                // Mostra o bot√£o de consulta CNPJ
                if (btnCnpj) {
                    btnCnpj.style.display = 'inline-block';
                    console.log('  ‚úÖ Bot√£o CNPJ exibido');
                } else {
                    console.log('  ‚ùå Bot√£o CNPJ n√£o encontrado!');
                }
                
                // Torna raz√£o social e nome fantasia obrigat√≥rios
                if (razaoSocialPj) {
                    razaoSocialPj.required = true;
                }
                if (nomeFantasia) {
                    nomeFantasia.required = true;
                }
            } else {
                // Pessoa F√≠sica
                labelDocumento.textContent = 'CPF';
                labelRgIe.textContent = 'RG';
                cpfCnpjInput.placeholder = '000.000.000-00';
                
                // Mostra campo nome simples
                if (campoNomeSimples) {
                    campoNomeSimples.style.display = 'block';
                    document.getElementById('nome').setAttribute('required', 'required');
                }
                
                // Esconde campos PJ
                camposPj.style.display = 'none';
                extrasPj.style.display = 'none';
                extrasPf.style.display = 'flex';
                
                // Esconde o bot√£o de consulta CNPJ
                if (btnCnpj) {
                    btnCnpj.style.display = 'none';
                }
                
                // Remove obrigatoriedade dos campos PJ
                if (razaoSocialPj) {
                    razaoSocialPj.required = false;
                }
                if (nomeFantasia) {
                    nomeFantasia.required = false;
                }
            }
        }
        
        // M√°scara para documento
        function mascaraDocumento(value, tipo) {
            value = value.replace(/\D/g, '');
            
            if (tipo === 'PF') {
                // CPF: 000.000.000-00
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            } else {
                // CNPJ: 00.000.000/0000-00
                value = value.replace(/(\d{2})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1/$2');
                value = value.replace(/(\d{4})(\d{1,2})$/, '$1-$2');
            }
            
            return value;
        }
        
        // M√°scara para CEP
        function mascaraCep(value) {
            value = value.replace(/\D/g, '');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            return value;
        }
        
        // M√°scara para telefone
        function mascaraTelefone(value) {
            value = value.replace(/\D/g, '');
            if (value.length <= 10) {
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            } else {
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            return value;
        }
        
        // Event listeners
        console.log('üéØ Registrando event listeners');
        tipoSelect.addEventListener('change', atualizarInterface);
        
        cpfCnpjInput.addEventListener('input', function() {
            this.value = mascaraDocumento(this.value, tipoSelect.value);
        });
        
        document.getElementById('cep').addEventListener('input', function() {
            this.value = mascaraCep(this.value);
        });
        
        ['telefone', 'celular', 'whatsapp', 'contato_telefone'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', function() {
                    this.value = mascaraTelefone(this.value);
                });
            }
        });
        
        // Estado em mai√∫sculo
        document.getElementById('estado').addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });

        // Consulta CNPJ automatica
        console.log('üîç Configurando bot√£o de consulta CNPJ:', btnConsultarCnpj ? '‚úÖ' : '‚ùå');
        
        if (btnConsultarCnpj) {
            btnConsultarCnpj.addEventListener('click', function() {
                console.log('üñ±Ô∏è BOT√ÉO CLICADO!');
            btnConsultarCnpj.addEventListener('click', function() {
                console.log('üîç Iniciando consulta CNPJ...');
                
                if (tipoSelect.value !== 'PJ') {
                    alert('‚ö†Ô∏è A consulta autom√°tica est√° dispon√≠vel apenas para Pessoa Jur√≠dica (CNPJ)');
                    return;
                }
                
                const cnpj = cpfCnpjInput.value;
                const cnpjLimpo = cnpj.replace(/\D/g, '');
                
                console.log('üìã CNPJ digitado:', cnpj);
                console.log('üìã CNPJ limpo:', cnpjLimpo);
                
                if (cnpjLimpo.length !== 14) {
                    alert('‚ö†Ô∏è CNPJ deve ter 14 d√≠gitos');
                    return;
                }
                
                // Mostra loading
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Consultando...';
                this.disabled = true;
                
                console.log('üåê Fazendo requisi√ß√£o para:', `/fornecedor/api/consultar-cnpj/${cnpjLimpo}`);
                
                // Usa endpoint espec√≠fico de fornecedor
                fetch(`/fornecedor/api/consultar-cnpj/${cnpjLimpo}`)
                    .then(response => {
                        console.log('üì° Resposta recebida:', response.status);
                        return response.json();
                    })
                    .then(data => {
                        console.log('üì¶ Dados recebidos:', data);
                        
                        if (data.success) {
                            let camposPreenchidos = [];
                            
                            // Preenche raz√£o social e fantasia
                            if (data.data.nome) {
                                const razaoSocial = document.getElementById('razao_social_pj');
                                if (razaoSocial) {
                                    razaoSocial.value = data.data.nome;
                                    camposPreenchidos.push('Raz√£o Social');
                                }
                            }
                            
                            // API de fornecedor retorna 'nome_fantasia'
                            if (data.data.nome_fantasia || data.data.fantasia) {
                                const fantasia = document.getElementById('nome_fantasia');
                                if (fantasia) {
                                    fantasia.value = data.data.nome_fantasia || data.data.fantasia;
                                    camposPreenchidos.push('Nome Fantasia');
                                }
                            } else if (data.data.nome) {
                                // Se n√£o tem fantasia, usa o nome como fantasia
                                const fantasia = document.getElementById('nome_fantasia');
                                if (fantasia) {
                                    fantasia.value = data.data.nome;
                                }
                            }
                            
                            // Preenche contatos
                            if (data.data.email) {
                                const email = document.getElementById('email');
                                if (email) {
                                    email.value = data.data.email;
                                    camposPreenchidos.push('Email');
                                }
                            }
                            if (data.data.telefone) {
                                const telefone = document.getElementById('telefone');
                                if (telefone) {
                                    telefone.value = mascaraTelefone(data.data.telefone);
                                    camposPreenchidos.push('Telefone');
                                }
                            }
                            
                            // Preenche endereco completo
                            const endereco = data.data.endereco || data.data;
                            if (endereco) {
                                if (endereco.cep) {
                                    document.getElementById('cep').value = mascaraCep(endereco.cep);
                                    camposPreenchidos.push('CEP');
                                }
                                if (endereco.logradouro) {
                                    document.getElementById('endereco').value = endereco.logradouro;
                                    camposPreenchidos.push('Endere√ßo');
                                }
                                if (endereco.numero) {
                                    document.getElementById('numero').value = endereco.numero;
                                }
                                if (endereco.complemento) {
                                    document.getElementById('complemento').value = endereco.complemento;
                                }
                                if (endereco.bairro) {
                                    document.getElementById('bairro').value = endereco.bairro;
                                    camposPreenchidos.push('Bairro');
                                }
                                if (endereco.cidade || endereco.municipio) {
                                    document.getElementById('cidade').value = endereco.cidade || endereco.municipio;
                                    camposPreenchidos.push('Cidade');
                                }
                                if (endereco.uf) {
                                    document.getElementById('estado').value = endereco.uf.toUpperCase();
                                    camposPreenchidos.push('UF');
                                }
                            }
                            
                            // Define o pa√≠s como Brasil
                            const paisElement = document.getElementById('pais');
                            if (paisElement) {
                                paisElement.value = 'Brasil';
                            }
                            
                            console.log('‚úÖ Campos preenchidos:', camposPreenchidos);
                            
                            alert('‚úÖ Dados da empresa carregados com sucesso!\n\n' +
                                  'üìã Campos preenchidos:\n‚Ä¢ ' + camposPreenchidos.join('\n‚Ä¢ '));
                        } else {
                            console.error('‚ùå Erro na resposta:', data.error);
                            alert('‚ùå Erro: ' + (data.error || 'N√£o foi poss√≠vel consultar o CNPJ'));
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Erro na requisi√ß√£o:', error);
                        alert('‚ùå Erro ao consultar CNPJ. Verifique sua conex√£o e tente novamente.');
                    })
                    .finally(() => {
                        // Remove loading
                        this.innerHTML = '<i class="fas fa-search"></i>';
                        this.disabled = false;
                        console.log('üèÅ Consulta finalizada');
                    });
            });
        }
        
        // Consulta CEP automatica
        const btnConsultarCep = document.getElementById('btn-consultar-cep');
        if (btnConsultarCep) {
            btnConsultarCep.addEventListener('click', function() {
                console.log('üîç Iniciando consulta CEP...');
                
                const cep = document.getElementById('cep').value;
                const cepLimpo = cep.replace(/\D/g, '');
                
                console.log('üìã CEP digitado:', cep);
                console.log('üìã CEP limpo:', cepLimpo);
                
                if (cepLimpo.length !== 8) {
                    alert('‚ö†Ô∏è CEP deve ter 8 d√≠gitos');
                    return;
                }
                
                // Mostra loading
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Consultando...';
                this.disabled = true;
                
                console.log('üåê Fazendo requisi√ß√£o para:', `/fornecedor/api/consultar-cep/${cepLimpo}`);
                
                // Usa endpoint espec√≠fico de fornecedor
                fetch(`/fornecedor/api/consultar-cep/${cepLimpo}`)
                    .then(response => {
                        console.log('üì° Resposta recebida:', response.status);
                        return response.json();
                    })
                    .then(data => {
                        console.log('üì¶ Dados recebidos:', data);
                        
                        if (data.success) {
                            let camposPreenchidos = [];
                            
                            // Preenche os campos de endereco
                            if (data.data.logradouro) {
                                document.getElementById('endereco').value = data.data.logradouro;
                                camposPreenchidos.push('Endere√ßo');
                            }
                            if (data.data.bairro) {
                                document.getElementById('bairro').value = data.data.bairro;
                                camposPreenchidos.push('Bairro');
                            }
                            if (data.data.cidade || data.data.localidade) {
                                document.getElementById('cidade').value = data.data.cidade || data.data.localidade;
                                camposPreenchidos.push('Cidade');
                            }
                            if (data.data.uf) {
                                document.getElementById('estado').value = data.data.uf.toUpperCase();
                                camposPreenchidos.push('UF');
                            }
                            
                            // Aplica mascara do CEP
                            document.getElementById('cep').value = mascaraCep(data.data.cep || cep);
                            
                            // Foca no campo n√∫mero
                            document.getElementById('numero').focus();
                            
                            console.log('‚úÖ Campos preenchidos:', camposPreenchidos);
                            
                            alert('‚úÖ Endere√ßo carregado com sucesso!\n\n' +
                                  'üìã Campos preenchidos:\n‚Ä¢ ' + camposPreenchidos.join('\n‚Ä¢ ') +
                                  '\n\nüí° Agora preencha o n√∫mero do im√≥vel.');
                        } else {
                            console.error('‚ùå Erro na resposta:', data.error);
                            alert('‚ùå Erro: ' + (data.error || 'CEP n√£o encontrado'));
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Erro na requisi√ß√£o:', error);
                        alert('‚ùå Erro ao consultar CEP. Verifique sua conex√£o e tente novamente.');
                    })
                    .finally(() => {
                        // Remove loading
                        this.innerHTML = '<i class="fas fa-search"></i>';
                        this.disabled = false;
                        console.log('üèÅ Consulta finalizada');
                    });
            });
        console.log('‚öôÔ∏è Inicializando interface...');
        atualizarInterface();

        // Foco no tipo primeiro
        tipoSelect.focus();
        console.log('‚úÖ Script de fornecedor carregado com sucesso!'e();

        // Foco no tipo primeiro
        tipoSelect.focus();
    });
</script>
{% endblock %}