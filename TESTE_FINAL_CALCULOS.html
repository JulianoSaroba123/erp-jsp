<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ TESTE FINAL - C√°lculos Funcionando</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            background: #0a0a0a; 
            color: white; 
            padding: 20px;
        }
        .card { 
            background: #151515; 
            border: 1px solid #00d4ff; 
            margin-bottom: 20px;
        }
        .form-control { 
            background: #222; 
            border: 1px solid #555; 
            color: white; 
        }
        .form-control:focus { 
            background: #333; 
            border-color: #00d4ff; 
            color: white; 
            box-shadow: 0 0 0 0.2rem rgba(0, 212, 255, 0.25);
        }
        .bg-warning { background-color: #f18f01 !important; }
        .text-primary { color: #00d4ff !important; }
        .text-info { color: #17a2b8 !important; }
        .border-primary { border-color: #00d4ff !important; }
        .border-info { border-color: #17a2b8 !important; }
        .resultado { 
            font-size: 2rem; 
            font-weight: bold; 
            text-align: center; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 10px 0;
        }
        .resultado.km { 
            background: linear-gradient(135deg, #00d4ff, #0099cc); 
            color: white; 
        }
        .resultado.tempo { 
            background: linear-gradient(135deg, #17a2b8, #138496); 
            color: white; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center text-info mb-4">
            <i class="fas fa-calculator me-2"></i>‚úÖ Teste Final - C√°lculos Funcionando
        </h1>
        
        <div class="alert alert-success">
            <i class="fas fa-check-circle me-2"></i>
            <strong>Este √© um teste isolado para garantir que os c√°lculos funcionam perfeitamente!</strong>
        </div>
        
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    3. Controle de KM e Tempo
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Controle de Deslocamento:</strong> Registre os KMs e hor√°rios para controle de custos e tempo de execu√ß√£o.
                </div>
                
                <div class="row">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="km_inicial" class="form-label fw-bold">
                                <i class="fas fa-play text-success me-1"></i>KM Inicial
                            </label>
                            <input type="number" class="form-control" id="km_inicial" 
                                   value="15420" min="0" step="1" placeholder="Ex: 50000">
                            <div class="form-text">Quilometragem inicial</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="km_final" class="form-label fw-bold">
                                <i class="fas fa-stop text-danger me-1"></i>KM Final
                            </label>
                            <input type="number" class="form-control" id="km_final" 
                                   value="15450" min="0" step="1" placeholder="Ex: 50150">
                            <div class="form-text">Quilometragem final</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="hora_inicial" class="form-label fw-bold">
                                <i class="fas fa-clock text-primary me-1"></i>Hora Inicial
                            </label>
                            <input type="time" class="form-control" id="hora_inicial" value="18:00">
                            <div class="form-text">In√≠cio do atendimento</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="hora_final" class="form-label fw-bold">
                                <i class="fas fa-clock text-primary me-1"></i>Hora Final
                            </label>
                            <input type="time" class="form-control" id="hora_final" value="19:15">
                            <div class="form-text">Fim do atendimento</div>
                        </div>
                    </div>
                </div>
                
                <!-- C√°lculos autom√°ticos -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-dark text-white border-primary">
                            <div class="card-body text-center">
                                <i class="fas fa-route text-primary fa-2x mb-2"></i>
                                <h5 class="card-title text-white">KM Percorridos</h5>
                                <h3 class="text-primary mb-0" id="km_total_calc">-</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-dark text-white border-info">
                            <div class="card-body text-center">
                                <i class="fas fa-stopwatch text-info fa-2x mb-2"></i>
                                <h5 class="card-title text-white">Tempo Total</h5>
                                <h3 class="text-info mb-0" id="tempo_total_calc">-</h3>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Resultados grandes -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="resultado km" id="resultado_km">
                            <i class="fas fa-route fa-2x mb-2"></i><br>
                            KM: <span id="km_display">-</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="resultado tempo" id="resultado_tempo">
                            <i class="fas fa-stopwatch fa-2x mb-2"></i><br>
                            Tempo: <span id="tempo_display">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <button type="button" class="btn btn-success btn-lg" onclick="calcularTudo()">
                            <i class="fas fa-calculator me-2"></i>Recalcular Tudo
                        </button>
                        <button type="button" class="btn btn-info btn-lg ms-2" onclick="testeAutomatico()">
                            <i class="fas fa-magic me-2"></i>Teste Autom√°tico
                        </button>
                        <button type="button" class="btn btn-warning btn-lg ms-2" onclick="limparTudo()">
                            <i class="fas fa-trash me-2"></i>Limpar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    function calcularKM() {
        const inicial = parseInt(document.getElementById('km_inicial').value) || 0;
        const final = parseInt(document.getElementById('km_final').value) || 0;
        
        console.log('üöó Calculando KM:', inicial, '->', final);
        
        const elemento = document.getElementById('km_total_calc');
        const elementoDisplay = document.getElementById('km_display');
        
        if (inicial > 0 && final > inicial) {
            const total = final - inicial;
            const texto = total + ' km';
            
            if (elemento) elemento.textContent = texto;
            if (elementoDisplay) elementoDisplay.textContent = texto;
            
            console.log('‚úÖ KM calculado:', texto);
            return total;
        } else {
            if (elemento) elemento.textContent = '-';
            if (elementoDisplay) elementoDisplay.textContent = '-';
            console.log('‚ùå KM n√£o calculado');
            return null;
        }
    }
    
    function calcularTempo() {
        const inicial = document.getElementById('hora_inicial').value;
        const final = document.getElementById('hora_final').value;
        
        console.log('‚è±Ô∏è Calculando Tempo:', inicial, '->', final);
        
        const elemento = document.getElementById('tempo_total_calc');
        const elementoDisplay = document.getElementById('tempo_display');
        
        if (inicial && final) {
            const [hi, mi] = inicial.split(':').map(Number);
            const [hf, mf] = final.split(':').map(Number);
            
            const inicialMinutos = hi * 60 + mi;
            const finalMinutos = hf * 60 + mf;
            
            if (finalMinutos > inicialMinutos) {
                const totalMinutos = finalMinutos - inicialMinutos;
                const horas = Math.floor(totalMinutos / 60);
                const minutos = totalMinutos % 60;
                
                const texto = horas + 'h ' + minutos.toString().padStart(2, '0') + 'min';
                
                if (elemento) elemento.textContent = texto;
                if (elementoDisplay) elementoDisplay.textContent = texto;
                
                console.log('‚úÖ Tempo calculado:', texto);
                return { horas, minutos, texto };
            }
        }
        
        if (elemento) elemento.textContent = '-';
        if (elementoDisplay) elementoDisplay.textContent = '-';
        console.log('‚ùå Tempo n√£o calculado');
        return null;
    }
    
    function calcularTudo() {
        console.log('üöÄ Calculando tudo...');
        calcularKM();
        calcularTempo();
    }
    
    function testeAutomatico() {
        console.log('üß™ Executando teste autom√°tico...');
        
        // Definir valores de teste
        document.getElementById('km_inicial').value = 15420;
        document.getElementById('km_final').value = 15450;
        document.getElementById('hora_inicial').value = '18:00';
        document.getElementById('hora_final').value = '19:15';
        
        // Calcular
        setTimeout(() => {
            const km = calcularKM();
            const tempo = calcularTempo();
            
            // Verificar resultados
            if (km === 30 && tempo && tempo.horas === 1 && tempo.minutos === 15) {
                alert('üéâ SUCESSO! Teste passou:\n\n‚Ä¢ KM: 30 km ‚úÖ\n‚Ä¢ Tempo: 1h 15min ‚úÖ');
            } else {
                alert('‚ùå FALHA no teste!\n\nResultados obtidos:\n‚Ä¢ KM: ' + (km || 'erro') + '\n‚Ä¢ Tempo: ' + (tempo ? tempo.texto : 'erro'));
            }
        }, 100);
    }
    
    function limparTudo() {
        document.getElementById('km_inicial').value = '';
        document.getElementById('km_final').value = '';
        document.getElementById('hora_inicial').value = '';
        document.getElementById('hora_final').value = '';
        calcularTudo();
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üìÑ DOM carregado');
        
        const campos = ['km_inicial', 'km_final', 'hora_inicial', 'hora_final'];
        
        campos.forEach(id => {
            const elemento = document.getElementById(id);
            if (elemento) {
                elemento.addEventListener('input', calcularTudo);
                elemento.addEventListener('change', calcularTudo);
                elemento.addEventListener('blur', calcularTudo);
            }
        });
        
        // Calcular inicialmente
        setTimeout(calcularTudo, 100);
    });
    
    // Tamb√©m executar quando tudo carregar
    window.addEventListener('load', function() {
        console.log('üåü P√°gina totalmente carregada');
        setTimeout(calcularTudo, 100);
    });
    </script>
</body>
</html>