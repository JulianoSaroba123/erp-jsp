<!DOCTYPE html>
<html>
<head>
    <title>Teste de Cálculos</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Teste de Cálculos de KM e Tempo</h1>
    
    <div>
        <label>KM Inicial:</label>
        <input type="number" id="km_inicial" value="15420">
    </div>
    
    <div>
        <label>KM Final:</label>
        <input type="number" id="km_final" value="15450">
    </div>
    
    <div>
        <label>Hora Inicial:</label>
        <input type="time" id="hora_inicial" value="17:00">
    </div>
    
    <div>
        <label>Hora Final:</label>
        <input type="time" id="hora_final" value="19:15">
    </div>
    
    <div>
        <h3>Resultados:</h3>
        <div>KM Percorridos: <span id="km_total_calc">-</span></div>
        <div>Tempo Total: <span id="tempo_total_calc">-</span></div>
    </div>

    <script>
    $(document).ready(function() {
        // Cálculo automático de KM
        function calcularKM() {
            const inicial = parseInt($('#km_inicial').val()) || 0;
            const final = parseInt($('#km_final').val()) || 0;
            
            console.log('Calculando KM:', inicial, final);
            
            if ($('#km_total_calc').length > 0) {
                if (inicial > 0 && final > inicial) {
                    const total = final - inicial;
                    $('#km_total_calc').text(total + ' km');
                    console.log('KM calculado:', total);
                } else {
                    $('#km_total_calc').text('-');
                    console.log('KM não calculado - valores inválidos');
                }
            }
        }

        // Cálculo automático de tempo
        function calcularTempo() {
            const inicial = $('#hora_inicial').val();
            const final = $('#hora_final').val();
            
            console.log('Calculando tempo:', inicial, final);
            
            if ($('#tempo_total_calc').length > 0) {
                if (inicial && final) {
                    const [hi, mi] = inicial.split(':').map(Number);
                    const [hf, mf] = final.split(':').map(Number);
                    
                    const inicialMinutos = hi * 60 + mi;
                    const finalMinutos = hf * 60 + mf;
                    
                    if (finalMinutos > inicialMinutos) {
                        const totalMinutos = finalMinutos - inicialMinutos;
                        const horas = Math.floor(totalMinutos / 60);
                        const minutos = totalMinutos % 60;
                        
                        const tempoTexto = horas + 'h ' + minutos.toString().padStart(2, '0') + 'min';
                        $('#tempo_total_calc').text(tempoTexto);
                        console.log('Tempo calculado:', tempoTexto);
                    } else {
                        $('#tempo_total_calc').text('-');
                        console.log('Tempo não calculado - hora final menor que inicial');
                    }
                } else {
                    $('#tempo_total_calc').text('-');
                    console.log('Tempo não calculado - valores vazios');
                }
            }
        }

        // Event listeners
        $('#km_inicial, #km_final').on('input keyup blur change', calcularKM);
        $('#hora_inicial, #hora_final').on('input keyup blur change', calcularTempo);

        // Inicialização
        setTimeout(function() {
            console.log('=== INICIANDO CÁLCULOS ===');
            console.log('KM Inicial:', $('#km_inicial').val());
            console.log('KM Final:', $('#km_final').val());
            console.log('Hora Inicial:', $('#hora_inicial').val());
            console.log('Hora Final:', $('#hora_final').val());
            
            calcularKM();
            calcularTempo();
            
            console.log('=== CÁLCULOS FINALIZADOS ===');
        }, 100);
    });
    </script>
</body>
</html>