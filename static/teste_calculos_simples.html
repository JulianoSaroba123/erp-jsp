<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Direto - C√°lculos KM e Tempo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { background: #0a0a0a; color: white; }
        .card { background: #151515; border: 1px solid #00d4ff; }
        .form-control { background: #222; border: 1px solid #555; color: white; }
        .form-control:focus { background: #333; border-color: #00d4ff; color: white; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center text-info mb-4">üß™ Teste Direto - C√°lculos</h1>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5><i class="fas fa-tachometer-alt me-2"></i>3. Controle de KM e Tempo</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="km_inicial" class="form-label">KM Inicial</label>
                                <input type="number" class="form-control" id="km_inicial" value="15420">
                            </div>
                            <div class="col-md-3">
                                <label for="km_final" class="form-label">KM Final</label>
                                <input type="number" class="form-control" id="km_final" value="15450">
                            </div>
                            <div class="col-md-3">
                                <label for="hora_inicial" class="form-label">Hora Inicial</label>
                                <input type="time" class="form-control" id="hora_inicial" value="18:00">
                            </div>
                            <div class="col-md-3">
                                <label for="hora_final" class="form-label">Hora Final</label>
                                <input type="time" class="form-control" id="hora_final" value="19:15">
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card bg-dark text-white border-primary">
                                    <div class="card-body text-center">
                                        <i class="fas fa-route text-primary fa-2x mb-2"></i>
                                        <h5 class="card-title text-white">KM Percorridos</h5>
                                        <h3 class="text-primary mb-0" id="km_total_calc">-</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-dark text-white border-info">
                                    <div class="card-body text-center">
                                        <i class="fas fa-stopwatch text-info fa-2x mb-2"></i>
                                        <h5 class="card-title text-white">Tempo Total</h5>
                                        <h3 class="text-info mb-0" id="tempo_total_calc">-</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <button type="button" class="btn btn-success" onclick="calcularTudo()">
                                    <i class="fas fa-calculator me-2"></i>Calcular Manualmente
                                </button>
                                <button type="button" class="btn btn-info ms-2" onclick="limparLog()">
                                    <i class="fas fa-trash me-2"></i>Limpar Console
                                </button>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6>Console de Debug</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="console" style="background: #000; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
                                            Aguardando execu√ß√£o...<br>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    function log(message) {
        const console = document.getElementById('console');
        const timestamp = new Date().toLocaleTimeString();
        console.innerHTML += `[${timestamp}] ${message}<br>`;
        console.scrollTop = console.scrollHeight;
    }
    
    function limparLog() {
        document.getElementById('console').innerHTML = 'Console limpo...<br>';
    }
    
    function calcularKM() {
        const inicial = parseInt(document.getElementById('km_inicial').value) || 0;
        const final = parseInt(document.getElementById('km_final').value) || 0;
        
        log(`üöó Calculando KM: ${inicial} -> ${final}`);
        
        const elemento = document.getElementById('km_total_calc');
        if (elemento) {
            if (inicial > 0 && final > inicial) {
                const total = final - inicial;
                elemento.textContent = total + ' km';
                log(`‚úÖ KM calculado: ${total} km`);
            } else {
                elemento.textContent = '-';
                log(`‚ùå KM n√£o calculado (valores inv√°lidos)`);
            }
        } else {
            log(`üî¥ ERRO: Elemento km_total_calc n√£o encontrado!`);
        }
    }
    
    function calcularTempo() {
        const inicial = document.getElementById('hora_inicial').value;
        const final = document.getElementById('hora_final').value;
        
        log(`‚è±Ô∏è Calculando Tempo: ${inicial} -> ${final}`);
        
        const elemento = document.getElementById('tempo_total_calc');
        if (elemento) {
            if (inicial && final) {
                const [hi, mi] = inicial.split(':').map(Number);
                const [hf, mf] = final.split(':').map(Number);
                
                const inicialMinutos = hi * 60 + mi;
                const finalMinutos = hf * 60 + mf;
                
                if (finalMinutos > inicialMinutos) {
                    const totalMinutos = finalMinutos - inicialMinutos;
                    const horas = Math.floor(totalMinutos / 60);
                    const minutos = totalMinutos % 60;
                    
                    const tempoTexto = horas + 'h ' + minutos.toString().padStart(2, '0') + 'min';
                    elemento.textContent = tempoTexto;
                    log(`‚úÖ Tempo calculado: ${tempoTexto}`);
                } else {
                    elemento.textContent = '-';
                    log(`‚ùå Tempo n√£o calculado (hora final menor)`);
                }
            } else {
                elemento.textContent = '-';
                log(`‚ùå Tempo n√£o calculado (valores vazios)`);
            }
        } else {
            log(`üî¥ ERRO: Elemento tempo_total_calc n√£o encontrado!`);
        }
    }
    
    function calcularTudo() {
        log('üöÄ Executando c√°lculos manuais...');
        calcularKM();
        calcularTempo();
    }
    
    // Executar quando p√°gina carregar
    $(document).ready(function() {
        log('üìÑ P√°gina carregada (jQuery ready)');
        
        // Event listeners
        $('#km_inicial, #km_final').on('input change', function() {
            log('üì° Event KM triggered');
            calcularKM();
        });
        
        $('#hora_inicial, #hora_final').on('input change', function() {
            log('üì° Event Tempo triggered');
            calcularTempo();
        });
        
        // Execu√ß√£o inicial
        setTimeout(function() {
            log('‚ö° Executando c√°lculos iniciais...');
            calcularKM();
            calcularTempo();
        }, 500);
    });
    
    // Tamb√©m executar com window.onload
    window.addEventListener('load', function() {
        log('üåü P√°gina totalmente carregada (window.onload)');
        setTimeout(function() {
            calcularKM();
            calcularTempo();
        }, 100);
    });
    </script>
</body>
</html>